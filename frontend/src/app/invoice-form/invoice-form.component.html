<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href=".\invoice-form.component.css">
</head>

<body>
  <form [formGroup]="invoiceForm" (ngSubmit)="submitInvoice()" class="invoice-form">
  <h2>{{ isEditMode ? 'Edit Invoice' : 'Create New Invoice' }}</h2>

  <h3>Client Details</h3>
  <div class="client-details">
    <input type="text" placeholder="Client Name *" formControlName="clientName" />
    <input type="email" placeholder="Email *" formControlName="email" />
    <input type="text" placeholder="Phone" formControlName="phone" />
    <input type="text" placeholder="Address" formControlName="address" />
    <select formControlName="payment_status">
      <option value="Pending">Pending</option>
      <option value="Paid">Paid</option>
      <option value="Overdue">Overdue</option>
    </select>
  </div>

  <h3>Items</h3>
  <div formArrayName="items">
    <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="item-row">
      <input class="item-name" type="text" placeholder="Item Name *" formControlName="itemName" />
      <input class="item-qty" type="number" placeholder="Qty *" formControlName="quantity" />
      <input class="item-price" type="number" placeholder="Price *" formControlName="price" />
      <input class="item-total" type="number" placeholder="Total" formControlName="total" readonly />
      <button type="button" class="remove-btn" (click)="removeItem(i)">‚ùå</button>
    </div>
  </div>

  <div class="tax-section">
  <label for="tax_rate">Tax Rate (%):</label>
  <input id="tax_rate" type="number" formControlName="tax_rate" />
</div>

<div class="totals-summary">
  <div>
    <span>Subtotal:</span>
    <span>{{ subtotal | currency:'INR' }}</span>
  </div>
  <div>
    <span>Tax ({{ invoiceForm.get('tax_rate')?.value }}%):</span>
    <span>{{ taxAmount | currency:'INR' }}</span>
  </div>
  <div class="grand-total">
    <span>Grand Total:</span>
    <span>{{ grandTotal | currency:'INR' }}</span>
  </div>
</div>

  <div class="actions">
    <button type="button" class="add-btn" (click)="addItem()">‚ûï Add Item</button>
    <button type="submit" class="submit-btn" [disabled]="invoiceForm.invalid">
      {{ isEditMode ? 'üíæ Update Invoice' : 'üíæ Create Invoice' }}
    </button>
  </div>
</form>

<form *ngIf="!invoiceCreationSuccess" [formGroup]="invoiceForm" (ngSubmit)="submitInvoice()">
  </form>

<div *ngIf="invoiceCreationSuccess">
  <h2>Invoice Created Successfully!</h2>
  <p>You can now download the PDF or send it directly to the client.</p>

  <button (click)="sendEmail()">Send Email</button>
  <button (click)="finish()">Create Another Invoice</button>

  <p *ngIf="statusMessage">{{ statusMessage }}</p>
</div>

</body>

</html>

